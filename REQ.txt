DONAMED - Backend Panel Administrativo (API Spec v2.1) 
Este repositorio contiene la documentaci√≥n y especificaciones t√©cnicas para el desarrollo del Backend 
del Panel Administrativo del sistema DONAMED. 
Esta especificaci√≥n ha sido actualizada bas√°ndose en el Diccionario de Datos final, 
incorporando m√≥dulos de log√≠stica, cat√°logos cl√≠nicos y gesti√≥n de proveedores. üõ† Tech Stack Definido ‚óè 
Runtime: Node.js ‚óè Framework: Express.js (o NestJS). ‚óè Base de Datos: PostgreSQL (Esquema relacional 
estricto seg√∫n diccionario). ‚óè ORM: Prisma (Obligatorio para el manejo de esquemas y migraciones). 
‚óè Seguridad: JWT con Roles (admin, super-admin, almacenista). üîê Autenticaci√≥n y Seguridad (Admin) 
El acceso requiere autenticaci√≥n JWT y validaci√≥n de roles (Tabla: Rol). 
M√©todo POST POST GET Ruta /api/v1/admin/auth/login Descripci√≥n Inicio de sesi√≥n. Retorna JWT + 
Info de Usuario. /api/v1/admin/auth/refresh /api/v1/admin/auth/me üì¶ M√≥dulos del Sistema 
1. Gesti√≥n de Solicitudes y Despachos (Core) Refrescar token expirado. Obtener perfil del administrador logueado. Manejo del ciclo de vida de la solicitud 
(Pendiente -> Aprobada -> Entregada). Reglas de Negocio (Diccionario): ‚óè Al aprobar, 
se debe reservar stock espec√≠fico de un Lote y Almac√©n (Tabla: Detalle_Solicitud). ‚óè La entrega final requiere registrar qui√©n recibi√≥ (Tabla: Despacho con cedula_recibido_por). 
Endpoints: M√©todo Ruta Descripci√≥n GET /api/v1/admin/requests Listar solicitudes. Filtros: Estado, Patolog√≠a, Centro M√©dico. GET /api/v1/admin/requests/:id Ver detalle (incluye docs JSON y relaci√≥n con Persona). PATCH /api/v1/admin/requests/:id/e valuate Aprobar/Rechazar. Si se aprueba, debe restar stock temporalmente. POST /api/v1/admin/requests/:id/d ispatch Generar registro en Tabla: Despacho. Finaliza el flujo. Body: { "cedula_recibido_por": "..." }. 2. Gesti√≥n de Medicamentos y Cat√°logo Maestro Administraci√≥n del producto (Tabla: Medicamento) y sus relaciones (Categoria, Via, Forma). Endpoints: M√©todo Ruta Descripci√≥n GET /api/v1/admin/medicines Listar medicamentos con sus relaciones (joins). POST /api/v1/admin/medicines Crear medicamento. Requiere IDVia_Administracion, IDCategoria, etc. PUT /api/v1/admin/medicines/:co de Editar ficha t√©cnica. DELETE /api/v1/admin/medicines/:co de Soft delete (cambiar estado a Inactivo). 2.1 Sub-Cat√°logos de Medicamentos (CRUDs Auxiliares) Necesarios para poblar los selectores al crear un medicamento. M√©todo Ruta Descripci√≥n GET/POST/PUT /api/v1/admin/categories Gesti√≥n de Tabla: Categoria. GET/POST/PUT /api/v1/admin/pharma-form s Gesti√≥n de Tabla: Forma_Farmaceutica. GET/POST/PUT /api/v1/admin/admin-routes Gesti√≥n de Tabla: Via_Administracion. 3. Log√≠stica e Inventario M√≥dulo cr√≠tico a√±adido seg√∫n el diccionario para manejar Almacen, Lote, Donaciones y Proveedor. 3.1 Proveedores y Donaciones M√©todo Ruta Descripci√≥n GET/POST /api/v1/admin/providers Gesti√≥n de Tabla: Proveedor. POST /api/v1/admin/donations Registrar entrada de mercanc√≠a (Tabla: Donaciones). Crea registros en Donacion_Medicamento. GET /api/v1/admin/donations Historial de ingresos por proveedor. 3.2 Almacenes y Lotes Control de d√≥nde est√° el medicamento y cu√°ndo vence. M√©todo Ruta Descripci√≥n GET/POST /api/v1/admin/warehouses Gesti√≥n de Tabla: Almacen (Sedes f√≠sicas). GET /api/v1/admin/inventory/bat ches Ver Lotes (Tabla: Lote). Filtros: FechaVencimiento (para alertas). GET /api/v1/admin/inventory/stoc k Vista consolidada de Tabla: Almacen_Medicamento. 4. Cat√°logos Cl√≠nicos y Configuraci√≥n Tablas auxiliares necesarias para la operaci√≥n m√©dica. M√©todo Ruta Descripci√≥n GET/POST/PUT /api/v1/admin/diseases Gesti√≥n de Tabla: Enfermedad (Patolog√≠as cubiertas). GET/POST/PUT /api/v1/admin/medical-cent ers Gesti√≥n de Tabla: Centro_medico (Hospitales autorizados). GET/POST/PUT /api/v1/admin/cities Gesti√≥n geogr√°fica (Ciudad y Provincia). 5. Gesti√≥n de Usuarios y Roles Control de acceso seg√∫n Tabla: Usuario y Tabla: Rol. M√©todo Ruta Descripci√≥n GET /api/v1/admin/users Listar usuarios. POST /api/v1/admin/users/staff Crear usuarios administrativos (con roles espec√≠ficos). PATCH /api/v1/admin/users/:id/role Cambiar rol (CodigoRol). PATCH /api/v1/admin/users/:id/stat us Banear/Activar usuario. 6. Reportes y Estad√≠sticas Consultas de alto nivel para el dashboard. M√©todo Ruta Descripci√≥n GET /api/v1/admin/stats/expiring Lotes pr√≥ximos a vencer (30/60/90 d√≠as). GET /api/v1/admin/stats/donatio ns Total donado vs Total despachado. GET /api/v1/admin/stats/patholo gies Top enfermedades solicitadas. üíæ Modelo de Datos (Referencias Cr√≠ticas) El backend debe respetar estrictamente las llaves for√°neas definidas en el diccionario: 1. Medicamento: No existe por s√≠ solo; depende de Categoria, Via y Forma. 2. Stock: No es un n√∫mero simple en la tabla medicamento. Es la suma de Tabla: Almacen_Medicamento agrupado por lote. 3. Despacho: No se puede borrar una solicitud si ya tiene un despacho asociado (FK). üöÄ Variables de Entorno (.env) PORT=4000 DATABASE_URL="postgresql://user:pass@localhost:5432/donamed_db" JWT_SECRET_ADMIN="super_secret_key" SMTP_HOST="smtp.provider.com